!function(a){a(document).ready(function(){function b(b){var c=a(b.element);return c.attr("title")?b.text+"<br><small>"+c.attr("title")+"</small>":b.text}function c(b){var c=a(b.element);return c.attr("title")?a.trim(b.text).substring(0,50).split(" ").slice(0,-1).join(" ")+"...<br><small>"+c.attr("title")+"</small>":a.trim(b.text).substring(0,50).split(" ").slice(0,-1).join(" ")+"..."}function d(a,b,c,d,e){a.append('<span style="left: '+(b-20)+"px; top: "+(c-20)+'px;" id="target-'+d+'" class="target"><a href="#" data-toggle="modal" data-target="#modal-'+d+'"><i class="fa fa-edit"></i></a><a href="#" class="remove" data-target="#modal-'+d+'" data-anno="'+e+'"><i class="fa fa-remove"></i></a></span>')}function e(b,c,d,e){var f='<div id="modal-'+d+'" class="modal modal-annotation fade"><div class="modal-dialog"><div class="modal-content"><div class="modal-body"><input type="text" placeholder="Heading"><textarea class="" placeholder="Describe the change" rows="6"></textarea></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button><button type="button" data-anno="'+e+'" data-xperc="'+b.toFixed(4)+'" data-yperc="'+c.toFixed(4)+'" class="btn btn-primary">Save changes</button></div></div></div></div>';h.append(f),a("#modal-"+d).modal("show")}function f(b,c,d,e,f,g){var j=a.grep(i["anno"+b],function(a){return a.id==g});if(j.length)j[0].heading=c,j[0].annotation=d;else{var k={id:g,heading:c,annotation:d,xperc:e,yperc:f};i["anno"+b].push(k)}var l=h.find("#target-"+g).parent();l.siblings("input.annotationArr").val(JSON.stringify(i["anno"+b]))}function g(a,b,c){var d=b.substr(b.indexOf("-")+1),e=h.find("#target-"+d).parent();h.find(b).remove();for(var f=0;f<i["anno"+c].length;f++){var g=i["anno"+c][f];-1!==d.indexOf(g.id)&&(i["anno"+c].splice(f,1),f--)}e.siblings("input.annotationArr").val(JSON.stringify(i["anno"+c])),a.closest(".target").remove()}var h=a("body");h.on("focus",".datepicker",function(){var b="MM yy";a(this).data("format")&&(b=a(this).data("format")),a(this).datepicker({dateFormat:b})}),h.on("click",".prodaq-widget__nav li a",function(b){b.preventDefault();var c=a(this).data("target");a(".prodaq-widget__nav li").removeClass("active"),a(this).parent().addClass("active"),a(".documentation__pane").removeClass("active"),a(".documentation__pane#"+c).addClass("active")}),a(".quoteFormat").select2({allowClear:!0,formatResult:b,formatSelection:c,containerCssClass:"tpx-select2-container",dropdownCssClass:"tpx-select2-drop select2-daq"}),a("#iteration-type").on("change",function(b){"element"==b.val?(a(".iteration__pane").removeClass("active"),a(".iteration__element").addClass("active")):"intro"==b.val?(a(".iteration__pane").removeClass("active"),a(".iteration__intro").addClass("active")):(a(".iteration__pane").removeClass("active"),a(".iteration__next").addClass("active"))}),a("#product-size").on("change",function(b){a(".download-template li").removeClass("active"),"mobile"==b.val?a(".download-template li#mobile").addClass("active"):"tablet"==b.val?a(".download-template li#tablet").addClass("active"):a(".download-template li#desktop").addClass("active")}),a("#findings-type").on("change",function(b){"document"==b.val?(a("#findingsDocument").removeClass("hidden"),a("#findingsReport").addClass("hidden")):(a("#findingsDocument").addClass("hidden"),a("#findingsReport").removeClass("hidden"))});var i={};h.on("click",".preview-wrapper img",function(b){var c=a(this).parent(),f=a(this).width(),g=a(this).height(),h=b.pageX-a(this).offset().left,j=b.pageY-a(this).offset().top,k=h/f,l=j/g,m=h.toString()+j.toString(),n=c.closest(".wpa_group-images").index();"undefined"==typeof i["anno"+n]&&(i["anno"+n]=[]),e(k,l,m,n),d(c,h,j,m,n)}).on("click",".modal .btn-primary",function(b){b.preventDefault();var c=a(this).closest(".modal"),d=parseInt(c.attr("id").substr(c.attr("id").indexOf("-")+1)),e=c.find("input").val(),g=c.find("textarea").val(),h=a(this).data("xperc"),i=a(this).data("yperc"),j=a(this).data("anno");f(j,e,g,h,i,d),c.modal("hide")}).on("click",".target .remove",function(b){b.preventDefault(),g(a(this).parent(),a(this).data("target"),a(this).data("anno"))}),a(".preview-wrapper").each(function(){var b=a(this),c=b.closest(".wpa_group-images").find("input.has-wrapper").val();if(c){a("<img/>").attr("src",c).appendTo(b)}}),a('a[data-toggle="tab"]').on("shown.bs.tab",function(b){a(".preview-wrapper").each(function(){var b=a(this),c=a.parseJSON(b.siblings(".annotationArr").val()),d=b.closest(".wpa_group-images").index(),e=b.find("img").width(),f=b.find("img").height();if(b.find(".target").remove(),i["anno"+d]=[],c)for(var g=0;g<c.length;g++){var j=c[g].id,k=c[g].heading,l=c[g].annotation,m=c[g].xperc,n=c[g].yperc,o=e*m,p=f*n,q={id:j,heading:k,annotation:l,xperc:m,yperc:n};i["anno"+d].push(q);var r='<div id="modal-'+j+'" class="modal modal-annotation fade"><div class="modal-dialog"><div class="modal-content"><div class="modal-body"><input type="text" placeholder="Heading" value="'+k+'"><textarea class="" rows="6">'+l+'</textarea></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button><button type="button" data-anno="'+d+'" data-xperc="'+m+'" data-yperc="'+n+'" class="btn btn-primary">Save changes</button></div></div></div></div>';h.append(r),b.append('<span style="left: '+(o-20)+"px; top: "+(p-20)+'px;" id="target-'+j+'" class="target"><a href="#" data-toggle="modal" data-target="#modal-'+j+'"><i class="fa fa-edit"></i></a><a href="#" class="remove" data-target="#modal-'+j+'" data-anno="'+d+'"><i class="fa fa-remove"></i></a></span>')}})}),a(".row-with-thumb").each(function(){var b=a(this).find(".form-group.hidden-input input").val();a(this).find(".preview-wrapper").append('<img width="100%" src="'+b+'">')}),a(".ckeditor-repeatable").ckeditor(),a(window).on("added",function(a){var d=a.state;d.find(".cke").remove(),d.find(".ckeditor-repeatable").ckeditor(),d.find(".select2-container").remove(),d.find("select.selectnice").select2({allowClear:!0,placeholder:"Select",containerCssClass:"tpx-select2-container",dropdownCssClass:"tpx-select2-drop select2-daq"}),d.find(".quoteFormat").select2({allowClear:!0,formatResult:b,formatSelection:c,containerCssClass:"tpx-select2-container",dropdownCssClass:"tpx-select2-drop select2-daq"}),d.find("input.selectnice-tags").select2({tags:[],tokenSeparators:[","],containerCssClass:"tpx-select2-container",dropdownCssClass:"tpx-select2-drop select2-daq"}),d.find(".select2-container").css("display","block")}),a("select.selectnice").select2({allowClear:!0,placeholder:"Select",containerCssClass:"tpx-select2-container",dropdownCssClass:"tpx-select2-drop select2-daq"}),a(".selectnice-tags").select2({tags:[],tokenSeparators:[","],containerCssClass:"tpx-select2-container",dropdownCssClass:"tpx-select2-drop select2-daq"}),a(".upload-inline").each(function(){var b=a(this).find('input[type="text"]').val();b.length>0&&a(this).find(".thumb-container").html('<img src="'+b+'">')});var j=!1;a("#search-participants").on("focus",function(){a(this).siblings("ul").addClass("show")}),a("#search-participants").blur(function(){j?j=!1:a(this).siblings("ul").removeClass("show")}),a("a").mousedown(function(){j=!0}),a("body").on("click",".ndaq-repeatable__header",function(){a(this).siblings(".ndaq-repeatable__body").toggleClass("active")})})}(jQuery);